<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Orleans.StateMachineES | Orleans.StateMachineES </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Orleans.StateMachineES | Orleans.StateMachineES ">
      
      
      <link rel="icon" href="favicon.ico">
      <link rel="stylesheet" href="public/docfx.min.css">
      <link rel="stylesheet" href="public/main.css">
      <meta name="docfx:navrel" content="toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="">
      
      
      <meta name="docfx:docurl" content="https://github.com/mivertowski/Orleans.StateMachineES/blob/main/docfx/index.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="index.html">
            <img id="logo" class="svg" src="images/logo.svg" alt="Orleans.StateMachineES Documentation">
            Orleans.StateMachineES Documentation
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="orleansstatemachinees">Orleans.StateMachineES</h1>

<p><strong>Production-ready state machines for Microsoft Orleans</strong></p>
<p>Orleans.StateMachineES brings the power of state machines to your Orleans applications, wrapping the battle-tested <a href="https://github.com/dotnet-state-machine/stateless">Stateless</a> library with Orleans-native async APIs, event sourcing, and advanced distributed patterns.</p>
<h2 id="why-orleansstatemachinees">Why Orleans.StateMachineES?</h2>
<p>Build reliable, maintainable distributed systems with:</p>
<ul>
<li><strong>Compile-time Safety</strong>: 10 Roslyn analyzers catch state machine anti-patterns before they reach production</li>
<li><strong>Event Sourcing Built-in</strong>: Complete state history with replay capabilities - and it's 30% faster than regular state machines</li>
<li><strong>Production Resilience</strong>: Circuit breakers, retries, validation components, and distributed tracing out of the box</li>
<li><strong>Advanced Patterns</strong>: Hierarchical states, distributed sagas, orthogonal regions, and versioning</li>
<li><strong>High Performance</strong>: TriggerParameterCache provides ~100x speedup for parameterized triggers, optimized object pooling</li>
</ul>
<h2 id="quick-start">Quick Start</h2>
<h3 id="installation">Installation</h3>
<pre><code class="lang-bash">dotnet add package Orleans.StateMachineES
dotnet add package Orleans.StateMachineES.Generators
</code></pre>
<h3 id="your-first-state-machine">Your First State Machine</h3>
<pre><code class="lang-csharp">using Orleans.StateMachineES;

public enum OrderState { Pending, Confirmed, Shipped, Delivered }
public enum OrderTrigger { Confirm, Ship, Deliver }

public interface IOrderGrain : IStateMachineGrain&lt;OrderState, OrderTrigger&gt;
{
}

public class OrderGrain : StateMachineGrain&lt;OrderState, OrderTrigger&gt;, IOrderGrain
{
    protected override void BuildStateMachine()
    {
        StateMachine.Configure(OrderState.Pending)
            .Permit(OrderTrigger.Confirm, OrderState.Confirmed)
            .OnEntry(() =&gt; GrainFactory.GetGrain&lt;INotificationGrain&gt;(0)
                .SendEmailAsync(&quot;Order received!&quot;));

        StateMachine.Configure(OrderState.Confirmed)
            .Permit(OrderTrigger.Ship, OrderState.Shipped);

        StateMachine.Configure(OrderState.Shipped)
            .Permit(OrderTrigger.Deliver, OrderState.Delivered);
    }
}
</code></pre>
<h3 id="usage">Usage</h3>
<pre><code class="lang-csharp">var order = grainFactory.GetGrain&lt;IOrderGrain&gt;(orderId);

// Fire transitions
await order.FireAsync(OrderTrigger.Confirm);
await order.FireAsync(OrderTrigger.Ship);

// Query state
var currentState = await order.GetStateAsync(); // OrderState.Shipped
var canDeliver = await order.CanFireAsync(OrderTrigger.Deliver); // true
var permitted = await order.GetPermittedTriggersAsync(); // [OrderTrigger.Deliver]
</code></pre>
<p><a href="articles/getting-started/index.html">Learn more in the Getting Started guide →</a></p>
<h2 id="key-features">Key Features</h2>
<h3 id="core-state-machines">Core State Machines</h3>
<p>The foundation of distributed state management with Orleans.</p>
<ul>
<li><strong>StateMachineGrain Base Class</strong>: Orleans-native async state machine grain</li>
<li><strong>Parameterized Triggers</strong>: Pass up to 3 typed arguments with transitions</li>
<li><strong>Guard Conditions</strong>: Validate transitions with business logic</li>
<li><strong>State Inspection</strong>: Query current state, permitted triggers, and guard status</li>
</ul>
<p><a href="articles/getting-started/core-concepts.html">Explore Core Concepts →</a></p>
<h3 id="event-sourcing">Event Sourcing</h3>
<p>Complete state history and replay capabilities - <strong>30.4% faster</strong> than regular state machines.</p>
<pre><code class="lang-csharp">public class OrderGrain : EventSourcedStateMachineGrain&lt;OrderState, OrderTrigger&gt;
{
    // Automatic event persistence and replay
    // Use AutoConfirmEvents = true for maximum performance
}
</code></pre>
<ul>
<li><strong>Automatic Event Persistence</strong>: All transitions saved as events</li>
<li><strong>State Replay</strong>: Rebuild grain state from event history</li>
<li><strong>Idempotency</strong>: Safe re-execution of transitions</li>
<li><strong>Stream Publishing</strong>: Orleans streams integration</li>
</ul>
<p><a href="articles/guides/event-sourcing.html">Learn about Event Sourcing →</a></p>
<h3 id="advanced-patterns">Advanced Patterns</h3>
<p><strong>Hierarchical States</strong>: Parent-child state relationships with substates</p>
<pre><code class="lang-csharp">StateMachine.Configure(OrderState.InTransit)
    .SubstateOf(OrderState.Active)
    .Permit(OrderTrigger.Delay, OrderState.Delayed);
</code></pre>
<p><strong>Distributed Sagas</strong>: Multi-grain workflows with compensation</p>
<pre><code class="lang-csharp">var saga = new OrderSaga();
await saga.ExecuteAsync(context);
// Automatic compensation on failure
</code></pre>
<p><strong>Orthogonal Regions</strong>: Parallel independent state machines</p>
<pre><code class="lang-csharp">var regions = new OrthogonalRegions&lt;SmartHomeState, SmartHomeTrigger&gt;();
regions.AddRegion(&quot;Lighting&quot;, lightingStateMachine);
regions.AddRegion(&quot;Climate&quot;, climateStateMachine);
</code></pre>
<p><a href="articles/guides/index.html">Explore Advanced Patterns →</a></p>
<h3 id="production-features">Production Features</h3>
<p><strong>Circuit Breaker</strong>: Prevent cascading failures</p>
<pre><code class="lang-csharp">var circuitBreaker = new CircuitBreakerComponent&lt;State, Trigger&gt;(new()
{
    FailureThreshold = 5,
    SuccessThreshold = 2,
    OpenDuration = TimeSpan.FromSeconds(30)
});
</code></pre>
<p><strong>Distributed Tracing</strong>: OpenTelemetry integration for observability</p>
<p><strong>Health Checks</strong>: ASP.NET Core health monitoring</p>
<p><strong>Versioning</strong>: Manage state machine evolution across deployments</p>
<p><a href="articles/architecture/production.html">Read Production Guide →</a></p>
<h3 id="compile-time-safety">Compile-time Safety</h3>
<p>10 Roslyn analyzers catch issues before deployment:</p>
<table>
<thead>
<tr>
<th>Analyzer</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>OSMES001</strong></td>
<td>Prevents async lambdas in callbacks</td>
</tr>
<tr>
<td><strong>OSMES002</strong></td>
<td>Blocks FireAsync in state callbacks</td>
</tr>
<tr>
<td><strong>OSMES003</strong></td>
<td>Requires BuildStateMachine implementation</td>
</tr>
<tr>
<td><strong>OSMES004</strong></td>
<td>Detects unreachable states</td>
</tr>
<tr>
<td><strong>OSMES009</strong></td>
<td>Ensures initial state is set</td>
</tr>
<tr>
<td><em>...and 5 more</em></td>
<td><a href="articles/guides/analyzers.html">See all analyzers →</a></td>
</tr>
</tbody>
</table>
<h3 id="visualization">Visualization</h3>
<p>Generate diagrams from your state machines:</p>
<pre><code class="lang-csharp">var visualization = new StateMachineVisualization&lt;State, Trigger&gt;(stateMachine);
var mermaid = visualization.GenerateMermaidDiagram();
var dot = visualization.GenerateDotGraph();
var plantuml = visualization.GeneratePlantUmlDiagram();
var html = visualization.GenerateHtmlDiagram();
</code></pre>
<p><a href="articles/guides/visualization.html">Learn about Visualization →</a></p>
<h2 id="performance">Performance</h2>
<p>Optimized for production workloads:</p>
<ul>
<li><strong>Event Sourcing</strong>: 5,923 transitions/sec (30% faster than regular grains)</li>
<li><strong>TriggerParameterCache</strong>: ~100x performance improvement for parameterized triggers</li>
<li><strong>ValueTask</strong>: Zero-allocation paths for synchronous operations</li>
<li><strong>FrozenCollections</strong>: 40%+ faster lookups in .NET 8+</li>
<li><strong>Object Pooling</strong>: Thread-safe, high-performance resource management</li>
</ul>
<p><a href="articles/architecture/performance.html">Read Performance Guide →</a></p>
<h2 id="complete-examples">Complete Examples</h2>
<p>Explore production-ready applications:</p>
<ul>
<li><strong><a href="articles/examples/ecommerce.html">E-Commerce Workflow</a></strong>: Event sourcing, timers, sagas</li>
<li><strong><a href="articles/examples/document-approval.html">Document Approval</a></strong>: Hierarchical states, multi-level approval</li>
<li><strong><a href="articles/examples/monitoring.html">Monitoring Dashboard</a></strong>: Health checks, metrics, observability</li>
<li><strong><a href="articles/examples/smart-home.html">Smart Home Automation</a></strong>: Orthogonal regions, source generator</li>
</ul>
<p><a href="articles/examples/index.html">Browse all examples →</a></p>
<h2 id="documentation">Documentation</h2>
<h3 id="for-developers">For Developers</h3>
<ul>
<li><a href="articles/getting-started/index.html">Getting Started</a> - Installation and first state machine</li>
<li><a href="articles/getting-started/core-concepts.html">Core Concepts</a> - Fundamental patterns</li>
<li><a href="articles/guides/async-patterns.html">Async Patterns</a> - Critical async operation guidelines</li>
<li><a href="articles/reference/cheat-sheet.html">Cheat Sheet</a> - Quick reference guide</li>
</ul>
<h3 id="for-architects">For Architects</h3>
<ul>
<li><a href="articles/architecture/index.html">Architecture Overview</a> - Design decisions and patterns</li>
<li><a href="articles/architecture/performance.html">Performance Tuning</a> - Optimization strategies</li>
<li><a href="articles/architecture/production.html">Production Deployment</a> - Production best practices</li>
</ul>
<h3 id="for-contributors">For Contributors</h3>
<ul>
<li><a href="articles/reference/contributing.html">Contributing Guide</a> - How to contribute</li>
<li><a href="articles/guides/analyzers.html">Analyzer Development</a> - Writing analyzers</li>
<li><a href="articles/architecture/testing.html">Testing Strategy</a> - Testing approach</li>
</ul>
<h2 id="api-reference">API Reference</h2>
<p>Browse the complete API documentation for all packages:</p>
<ul>
<li><a href="api/Orleans.StateMachineES.yml">Orleans.StateMachineES</a> - Main library</li>
<li><a href="api/Orleans.StateMachineES.Abstractions.yml">Orleans.StateMachineES.Abstractions</a> - Core interfaces</li>
<li><a href="api/Orleans.StateMachineES.Generators.yml">Orleans.StateMachineES.Generators</a> - Analyzers and generators</li>
</ul>
<p><a href="api/index.html">Explore API Reference →</a></p>
<h2 id="version-information">Version Information</h2>
<p><strong>Current Version</strong>: 1.0.4 (Released November 2025)</p>
<p><strong>Latest Improvements</strong>:</p>
<ul>
<li>Event sourcing performance: 30.4% faster with AutoConfirmEvents</li>
<li>Enhanced production resilience components</li>
<li>Comprehensive analyzer suite (10 analyzers)</li>
<li>Performance optimizations across the board</li>
</ul>
<p><a href="https://github.com/mivertowski/Orleans.StateMachineES/blob/main/CHANGELOG.md">View Changelog</a> | <a href="articles/reference/migration-guide.html">Migration Guide</a></p>
<h2 id="community--support">Community &amp; Support</h2>
<ul>
<li><strong>GitHub</strong>: <a href="https://github.com/mivertowski/Orleans.StateMachineES">Orleans.StateMachineES Repository</a></li>
<li><strong>Issues</strong>: <a href="https://github.com/mivertowski/Orleans.StateMachineES/issues">Report a bug</a></li>
<li><strong>Discussions</strong>: <a href="https://github.com/mivertowski/Orleans.StateMachineES/discussions">Ask questions</a></li>
<li><strong>NuGet</strong>: <a href="https://www.nuget.org/packages/Orleans.StateMachineES">Package Downloads</a></li>
</ul>
<h2 id="license">License</h2>
<p>Orleans.StateMachineES is licensed under the <a href="https://github.com/mivertowski/Orleans.StateMachineES/blob/main/LICENSE">MIT License</a>.</p>
<hr>
<p><strong>Ready to get started?</strong> <a href="articles/getting-started/installation.html">Install Orleans.StateMachineES →</a></p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/mivertowski/Orleans.StateMachineES/blob/main/docfx/index.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          Orleans.StateMachineES - Production-ready state machines for Microsoft Orleans
        </div>
      </div>
    </footer>
  </body>
</html>
